#!/bin/sh

PATH=$PATH:"/cygdrive/c/Program Files (x86)/WiX Toolset v3.7/bin"
DIRNAME=$(cd `dirname $0` && pwd)

if [ $# -lt 1 ]; then
	echo Usage $0 OUTPUT.msi
	exit 1
fi

OUTFILE=$(cygpath.exe -w $1)
SPELLPRODUCT_WXS=$(cygpath.exe -w $DIRNAME/SpellProduct.wxs)
TEMP_WXS=$(cygpath.exe -w /tmp/files.wxs)
TEMP_WIXOBJ=$(cygpath.exe -w /tmp/spellProduct.wixobj)

echo Generating MSI package in output file $OUTFILE

heat dir . -gg -dr INSTALLDIR -cg SpellProduct -template fragment -out $TEMP_WXS
candle.exe $SPELLPRODUCT_WXS $TEMP_WXS -o $TEMP_WIXOBJ
light.exe $TEMP_WIXOBJ -out $OUTFILE
