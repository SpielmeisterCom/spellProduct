#!/bin/sh

PATH=$PATH:"/cygdrive/c/Program Files (x86)/WiX Toolset v3.7/bin"
DIRNAME=$(cd `dirname $0` && pwd)

if [ $# -lt 1 ]; then
	echo Usage $0 OUTPUT.msi
	exit 1
fi

OUTFILE=$(cygpath.exe -w $1)
SPELLPRODUCT_WXS=$DIRNAME/SpellProduct.wxs
TMP_DIR=/tmp/$$
TMP_WXS=$TMP_DIR/files.wxs

mkdir $TMP_DIR
mkdir $TMP_DIR/wixobj

echo Generating MSI package in output file $OUTFILE using TMP_DIR $TMP_DIR

heat dir . -gg -dr INSTALLDIR -cg SpellProduct -template fragment -out $(cygpath.exe -w $TMP_WXS)

candle.exe $(cygpath.exe -w $SPELLPRODUCT_WXS) $(cygpath.exe -w $TMP_WXS) -o $(cygpath.exe -w $TMP_DIR/wixobj)\\

light.exe $(cygpath.exe -w $TMP_DIR/wixobj)\\* -out $OUTFILE

rm -rf $TMP_DIR

