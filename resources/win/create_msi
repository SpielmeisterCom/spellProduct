#!/bin/sh

PATH=$PATH:"/cygdrive/c/Program Files (x86)/WiX Toolset v3.7/bin"
DIRNAME=$(cd `dirname $0` && pwd)

if [ $# -lt 1 ]; then
	echo Usage $0 OUTPUT.msi
	exit 1
fi

OUTFILE=$(cygpath.exe -w $1)
SPELLPRODUCT_WXS=$(cygpath.exe -w $DIRNAME/SpellProduct.wxs)
TEMP_WXS=$(cygpath.exe -w /tmp/files.wxs)

TMP_DIR=$(cygpath.exe -w /tmp/$$)

mkdir $TMP_DIR

echo Generating MSI package in output file $OUTFILE using TMP_DIR $TMP_DIR

heat dir . -gg -dr INSTALLDIR -cg SpellProduct -template fragment -out $TEMP_WXS
candle.exe $SPELLPRODUCT_WXS $TEMP_WXS -o $TMP_DIR\\
light.exe $TMP_DIR\\* -out $OUTFILE
